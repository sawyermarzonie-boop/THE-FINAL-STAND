<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miku Minesweeper</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

#video-bg {
  position: fixed;
  top:0; left:0;
  width:100%;
  height:100%;
  object-fit: cover;
  z-index:-1;
}

#main-container {
  background: rgba(0,0,0,0.75);
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 1200px;
  height: 90%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  color: white;
  overflow: hidden;
}

.ui-panel {
  text-align: center;
}

button, select {
  margin-top: 10px;
}

#minesweeper {
  display: grid;
  width: 100%;
  flex-grow:1;
  gap:2px;
  justify-content: center;
  align-content: center;
}

.cell {
  background: #999;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  font-size: 1.2em;
  cursor: pointer;
  user-select: none;
}

.cell.revealed { background: #ccc; cursor: default; }
.cell.flag { background: orange; }

#confetti {
  position: fixed;
  top:0; left:0;
  width:100vw;
  height:100vh;
  pointer-events:none;
  z-index:20;
  display:none;
}
</style>
</head>
<body>

<video id="video-bg" autoplay loop muted playsinline>
  <source src="https://cdn.pixabay.com/vimeo/358426593/Miku_Concert.mp4" type="video/mp4">
  Your browser doesnâ€™t support video.
</video>

<div id="main-container">
  <div class="ui-panel">
    <h2>Miku Minesweeper</h2>
    <label><input type="checkbox" id="music-toggle" checked> Music</label>
    <label><input type="checkbox" id="video-toggle" checked> Video</label><br>
    <label>Difficulty:
      <select id="diff">
        <option value="easy">Easy 5Ã—5</option>
        <option value="medium">Medium 8Ã—8</option>
        <option value="hard">Hard 10Ã—10</option>
      </select>
    </label><br>
    <button onclick="startGame()">Restart Game</button>
    <div id="mine-count"></div>
  </div>

  <div id="minesweeper"></div>
</div>

<canvas id="confetti"></canvas>
<audio id="bgmusic" loop>
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<script>
let rows, cols, mines, board, revealed, flags;

// DOM
const minesweeper = document.getElementById('minesweeper');
const mineCountEl = document.getElementById('mine-count');

// Difficulty
function setDifficulty(d){
  if(d==='easy'){ rows=5; cols=5; mines=5;}
  else if(d==='medium'){ rows=8; cols=8; mines=12;}
  else{ rows=10; cols=10; mines=20;}
}

// Start Game
function startGame(){
  setDifficulty(document.getElementById('diff').value);
  flags=0;
  initBoard();
  updateMineCount();
}

// Update Mine Counter
function updateMineCount(){
  mineCountEl.innerText = `Mines: ${mines - flags}`;
}

// Init Board
function initBoard(){
  board = Array(rows).fill().map(()=>Array(cols).fill(0));
  revealed = Array(rows).fill().map(()=>Array(cols).fill(false));
  
  // Place mines
  let placed=0;
  while(placed<mines){
    let r = Math.floor(Math.random()*rows);
    let c = Math.floor(Math.random()*cols);
    if(board[r][c]!=='M'){ board[r][c]='M'; placed++; }
  }

  // Count neighbors
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(board[r][c]!=='M'){
        let count=0;
        for(let dr=-1;dr<=1;dr++){
          for(let dc=-1;dc<=1;dc++){
            let nr=r+dr,nc=c+dc;
            if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&board[nr][nc]==='M') count++;
          }
        }
        board[r][c]=count;
      }
    }
  }

  // Render grid
  minesweeper.innerHTML='';
  minesweeper.style.gridTemplateColumns=`repeat(${cols},1fr)`;
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.r=r;
      cell.dataset.c=c;
      cell.onclick = ()=>revealCell(cell);
      cell.oncontextmenu = e => { e.preventDefault(); toggleFlag(cell); };
      minesweeper.appendChild(cell);
    }
  }

  // Auto-scale cells
  let cellSize = Math.min(minesweeper.clientWidth/cols, minesweeper.clientHeight/rows);
  document.querySelectorAll('.cell').forEach(c=>{
    c.style.width = `${cellSize}px`;
    c.style.height = `${cellSize}px`;
  });
}

// Flag toggle
function toggleFlag(cell){
  let r=+cell.dataset.r, c=+cell.dataset.c;
  if(revealed[r][c]) return;
  cell.classList.toggle('flag');
  flags += cell.classList.contains('flag')?1:-1;
  updateMineCount();
}

// Reveal cell
function revealCell(cell){
  let r=+cell.dataset.r, c=+cell.dataset.c;
  if(cell.classList.contains('flag')||revealed[r][c]) return;
  revealed[r][c]=true;
  cell.classList.add('revealed');

  if(board[r][c]==='M'){
    alert("Boom ðŸ’¥");
    startGame();
    return;
  }

  if(board[r][c]>0) cell.innerText = board[r][c];
  else{
    for(let dr=-1;dr<=1;dr++){
      for(let dc=-1;dc<=1;dc++){
        let nr=r+dr,nc=c+dc;
        if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&!revealed[nr][nc]){
          const nxt=document.querySelector(`.cell[data-r='${nr}'][data-c='${nc}']`);
          revealCell(nxt);
        }
      }
    }
  }

  checkWin();
}

// Check Win
function checkWin(){
  let safeCells=0;
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(!revealed[r][c]&&board[r][c]!=='M') safeCells++;
    }
  }
  if(safeCells===0){
    startConfetti();
    setTimeout(startGame,3000);
  }
}

// Confetti
const confettiCanvas=document.getElementById('confetti');
const ctx=confettiCanvas.getContext('2d');
confettiCanvas.width=window.innerWidth;
confettiCanvas.height=window.innerHeight;
let particles=[];

function createConfetti(){
  particles=[];
  for(let i=0;i<150;i++){
    particles.push({
      x:Math.random()*confettiCanvas.width,
      y:Math.random()*confettiCanvas.height-confettiCanvas.height,
      r:Math.random()*6+4,
      d:Math.random()*150+50,
      color:`hsl(${Math.random()*360},100%,50%)`,
      tilt:Math.random()*10-10
    });
  }
}

function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  particles.forEach(p=>{
    ctx.beginPath();
    ctx.lineWidth=p.r/2;
    ctx.strokeStyle=p.color;
    ctx.moveTo(p.x+p.tilt+p.r/4,p.y);
    ctx.lineTo(p.x+p.tilt,p.y+p.tilt+p.r/4);
    ctx.stroke();
    p.y+=2;
    if(p.y>confettiCanvas.height) p.y=-10;
  });
}

function startConfetti(){
  confettiCanvas.style.display='block';
  createConfetti();
  let interval=setInterval(drawConfetti,20);
  setTimeout(()=>{
    clearInterval(interval);
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    confettiCanvas.style.display='none';
  },4000);
}

// Music toggle
document.getElementById('music-toggle').addEventListener('change',e=>{
  const music=document.getElementById('bgmusic');
  if(e.target.checked) music.play(); else music.pause();
});

// Video toggle
document.getElementById('video-toggle').addEventListener('change',e=>{
  document.getElementById('video-bg').style.display = e.target.checked?'block':'none';
});

// Resize confetti
window.addEventListener('resize',()=>{
  confettiCanvas.width=window.innerWidth;
  confettiCanvas.height=window.innerHeight;
});

startGame();
</script>

</body>
</html>

